<?php$NameNews = $list = $FullNews = '';$IdCategory = 0;if (isset($_POST['add'])) {    $NameNews = strip_tags($_POST['NameNews']);    $FullNews = $_POST['FCKeditor'];    $SearchText = strip_tags($FullNews);    $IdCategory = $_POST['category'];    $SmallText = trim(ModuleNews::SelectTextSmall($FullNews));    if (!empty($_POST['addcomment']) && $_POST['addcomment'] == 1) $commentsAdd = 1;    else $commentsAdd = 0;    if (!is_numeric($IdCategory) || $IdCategory < 1) $IdCategory = 0;    if (!is_numeric($_POST['day']) || !is_numeric($_POST['month']) || !is_numeric($_POST['year']) || !is_numeric($_POST['hour']) || !is_numeric($_POST['minute']) || !is_numeric($_POST['second'])) echo CMS::AlertWindow('Ошибка', 'Неверный формат даты', 3, 0);    else {        if (strlen($NameNews) < 3) echo CMS::AlertWindow('Ошибка', 'Название новости должно быть более 3-х символов', 3, 0);        else {            if (empty($FullNews)) echo CMS::AlertWindow('Ошибка', 'Не указан текст новости', 3, 0);            else {                if (!empty($_POST['enddate']) && ($_POST['year'] > $_POST['yearend'] ||                        ($_POST['month'] > $_POST['monthend'] && $_POST['year'] == $_POST['yearend']) ||                        ($_POST['day'] > $_POST['dayend'] && $_POST['month'] == $_POST['monthend'] && $_POST['year'] == $_POST['yearend']) ||                        ($_POST['day'] == $_POST['dayend'] && $_POST['month'] == $_POST['monthend'] && $_POST['year'] == $_POST['yearend'] &&                            ($_POST['hour'] > $_POST['hourend'] || (($_POST['minute'] > $_POST['minuteend'] || ($_POST['second'] > $_POST['secondend'] && $_POST['minute'] == $_POST['minuteend'])) && $_POST['hour'] == $_POST['hourend'])))))                    echo CMS::AlertWindow('Ошибка', 'Дата начала публикации больше даты окончания', 3, 0);                else {                    $IdPage = Simple_DbApi::auto_increment($_GET['name_tamlates']);                    CMS::InsertSearchText($IdPage, $SearchText, "/" . $_GET['name_tamlates'] . "/0/in/" . $IdCategory . "/0/" . $IdPage . "/", $NameNews);                    $DateNews = dateFormat($_POST['year']) . '-' . (dateFormat($_POST['month']) + 1) . '-' . dateFormat($_POST['day']);                    $TimeNews = dateFormat($_POST['hour']) . ':' . dateFormat($_POST['minute']) . ':' . dateFormat($_POST['second']);                    $DateNewsEnd = $TimeNewsEnd = '';                    if (!empty($_POST['enddate'])) {                        $DateNewsEnd = dateFormat($_POST['yearend']) . '-' . (dateFormat($_POST['monthend']) + 1) . '-' . dateFormat($_POST['dayend']);                        $TimeNewsEnd = dateFormat($_POST['hourend']) . ':' . dateFormat($_POST['minuteend']) . ':' . dateFormat($_POST['secondend']);                    }                    $file = $_FILES['file']['tmp_name'];                    $file_name = $_FILES['file']['name'];                    if (!empty($file_name)) {                        $idImg = Simple_DbApi::auto_increment($_GET['name_tamlates']);                        $nameFile = $idImg . "." . simple_imagetest_format($file_name, 2);                        $path3 = "images/" . $_GET['name_tamlates'] . "/small/" . $nameFile;                        move_uploaded_file($file, $path3);                        simple_image_save($SmallImageWidth, $SmallImageHeight, $path3, $path3, simple_imagetest_format($file_name, 2), 1);                        Simple_DbApi::insert_db($_GET['name_tamlates'], "id,id_cat,name,search,small,full,date,read,time,comment,countcomments,type,dateend,timeend", "<><>" . $IdCategory . "<><>" . $NameNews . "<><>" . $SearchText . "<><>" . $SmallText . "<><>" . $FullNews . "<><>" . $DateNews . "<><>0" . "<><>" . $TimeNews . "<><>" . $commentsAdd . "<><>0" . '<><>' . simple_imagetest_format($file_name, 2) . "<><>" . $DateNewsEnd . "<><>" . $TimeNewsEnd);                    } else {                        Simple_DbApi::insert_db($_GET['name_tamlates'], "id,id_cat,name,search,small,full,date,read,time,comment,countcomments,dateend,timeend", "<><>" . $IdCategory . "<><>" . $NameNews . "<><>" . $SearchText . "<><>" . $SmallText . "<><>" . $FullNews . "<><>" . $DateNews . "<><>0" . "<><>" . $TimeNews . "<><>" . $commentsAdd . "<><>0" . "<><>" . $DateNewsEnd . "<><>" . $TimeNewsEnd);                    }                    echo CMS::AlertWindow('Успешно', 'Новость добавлена', 1, 0);                    CMS::UserEvents('<b>' . $_SESSION["login_admin"] . '</b> добавил новость <b>' . $NameNews . '</b> в модуле <b>' . $TitleModule . '</b>. Раздел <a target="_blank" href="main-modules-setting-mod-' . $_GET['name_tamlates'] . '-7.pl"><b>Добавить новость</b></a>');                    //Simple_DbApi::insert_db($_GET['name_tamlates'],"id,id_cat,name,search,small,full,date,read,time,comment,countcomments,dateend,timeend","<><>".$IdCategory."<><>".$NameNews."<><>".$SearchText."<><>".$SmallText."<><>".$FullNews."<><>".$DateNews."<><>0"."<><>".$TimeNews."<><>".$commentsAdd."<><>0"."<><>".$DateNewsEnd."<><>".$TimeNewsEnd);                    # DESTROY #                    unset($NameNews);                    unset($FullNews);                    unset($SearchText);                    unset($commentsAdd);                }            }        }    }}$SelectC = Simple_DbApi::select_db($_GET['name_tamlates'] . "_cat", "*", "", "", "names", 1, "", "");if (!empty($SelectC)) {    foreach ($SelectC as $i => $nc) {        $select = '';        if ($IdCategory == $nc['ids']) $select = "selected";        $list .= CMS::AdminModuleSection(19, "{ID},{NAME},{selected}", $nc['ids'] . "<><>" . $nc['names'] . "<><>" . $select);    }}$NameNews = $FullNews = '';$FullNews = str_replace("\\", "", $FullNews);$editor = CMS::CKeditor($FullNews, '', '');if ($comment == 1) {    $com1 = "";    $com2 = "";    if ($commentsAdd == 1) $com1 = "selected";    else $com2 = "selected";    $FormComment = CMS::AdminModuleSection(22, "{com1},{com2}", $com1 . "<><>" . $com2);} else $FormComment = "";# DATE #$day = $month = $hour = $minute = $second = '';for ($d = 1; $d < 32; $d++) {    if (date('j') == $d) $day .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>selected');    else $day .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>');}for ($d = 0; $d < count($DateList); $d++) {    if ((date('n') - 1) == $d) $month .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $DateList[$d] . '<><>selected');    else $month .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $DateList[$d] . '<><>');}for ($d = 0; $d < 24; $d++) {    if (date('G') == $d) $hour .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>selected');    else $hour .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>');}for ($d = 0; $d < 60; $d++) {    if (round(date('i')) == $d) $minute .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>selected');    else $minute .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>');}for ($d = 0; $d < 60; $d++) {    if (round(date('s')) == $d) $second .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>selected');    else $second .= CMS::AdminModuleSection(65, '{n},{name},{s}', $d . '<><>' . $d . '<><>');}echo CMS::AdminModuleSection(3, "{form},{CATEGORY},{name},{comment},{day},{month},{year},{hour},{minute},{second},{dayend},{monthend},{yearend},{hourend},{minuteend},{secondend}", $editor . "<><>" . $list . "<><>" . $NameNews . "<><>" . $FormComment . "<><>" . $day . "<><>" . $month . "<><>" . date('Y') . "<><>" . $hour . "<><>" . $minute . "<><>" . $second . "<><>" . $day . "<><>" . $month . "<><>" . date('Y') . "<><>" . $hour . "<><>" . $minute . "<><>" . $second);?>