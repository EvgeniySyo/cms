<?php$SelectionOption1 = " WHERE `status`='0' ";$SelectionOption2 = " AND `status`='0' ";if ($TimePublic) {    $datenum = date("Y-m-j");    $SelectionOption1 .= "AND ( `dateend` ='0000-00-00' OR ((`dateend` > CURDATE() AND `date` < CURDATE())	OR ( ( `dateend`=CURDATE() AND `timeend`>CURTIME() AND `date`=CURDATE() AND `time`<CURTIME() ) OR (`dateend` > CURDATE() AND `date`=CURDATE() AND `time`<CURTIME()) OR (`date` < CURDATE() AND `dateend`=CURDATE() AND `timeend`>CURTIME()) ))  ) ";    $SelectionOption2 .= " AND ( `dateend` ='0000-00-00' OR ((`dateend` > CURDATE() AND `date` < CURDATE())	OR ( ( `dateend`=CURDATE() AND `timeend`>CURTIME() AND `date`=CURDATE() AND `time`<CURTIME() ) OR (`dateend` > CURDATE() AND `date`=CURDATE() AND `time`<CURTIME()) OR (`date` < CURDATE() AND `dateend`=CURDATE() AND `timeend`>CURTIME()) ))  ) ";}CMS::CoreComponent('json');if (isset($_POST['send'])) {    $idNewsSend = strip_tags($_POST['idnew']);    $newsname = strip_tags($_POST['namenew']);    $fio = strip_tags($_POST['fio']);    $email = strip_tags($_POST['email']);    $phone = strip_tags($_POST['phone']);    $company = strip_tags($_POST['company']);    $post = strip_tags($_POST['post']);    $reklama = $_POST['reklama'] == 1 ? 'Да' : 'Нет';    $addition = $_POST['addition'] == 1 ? 'Да' : 'Нет';    $dataAr = array(        'fio' => $fio,        'email' => $email,        'phone' => $phone,        'company' => $company,        'post' => $post,        'reklama' => $reklama,        'addition' => $addition    );    if (is_numeric($idNewsSend)) {        Simple_DbApi::insert_db('news_send', 'id_news,data,date', $idNewsSend . '<><>' . Simple_Json::encode($dataAr) . '<><>' . date('Y-m-d H:i:s'));        include("includes/class.phpmailer.php");        $fromMail = 'no-reply@' . $_SERVER['HTTP_HOST'];        $subject = 'Новая запись на мероприятие';        $toMail = $mailsend;        $html = '<p>Запись на ' . $newsname . '</p>		<p>ФИО: ' . $fio . '</p>		<p>E-mail: ' . $email . '</p>		<p>Телефон: ' . $phone . '</p>		<p>Компания: ' . $company . '</p>		<p>Должность: ' . $post . '</p>		<p>Хочу рекламировать организацию, товары, услуги во время конференции: ' . $reklama . '</p>		<p>Хочу участвовать в дополнительной программе конференции: ' . $addition . '</p>		';        $mail12 = new PHPMailer();        $mail12->setFrom($fromMail);        $mail12->addAddress($toMail);        $mail12->Subject = $subject;        $mail12->isHTML();        $mail12->CharSet = 'UTF-8';        $mail12->Body = $html;        $mail12->send();        $content .= '<div class="dialog_bg"></div>	   <div class="dialog">		  <div class="dialog_content"><span class="closed"></span>Ваша заявка успешно отправлена</div>	   </div>	   ';    }}$PageBreak ? $textindex = "small" : $textindex = "full";$textindex = "small";function CountDateNews($date, $status, $id){    if ($status == 1) $s = '<';    else if ($status == 2) $s = '>';    else $s = '=';    $Select = CMS::$db->query("SELECT COUNT(*) FROM `" . $_GET['page'] . "` WHERE `date` " . $s . " '" . $date . "' AND `id_cat` = '" . $id . "'" . $SelectionOption2);    $all = $Select[0]['COUNT(*)'];    return $all;}$MaxListNumber = 10;$MaxListComment = 10;$posterPage = 3;$id_f = 0;$DateList = array("Января", "Февраля", "Марта", "Апреля", "Мая", "Июня", "Июля", "Августа", "Сентября", "Октября", "Ноября", "Декабря");$WeekList = array("воскресенье", "понедельник", "вторник", "среда", "четверг", "пятница", "суббота");if (!isset($_GET['in']) || !is_numeric($_GET['in'])) {    if ($TitleNews != 1)        $GLOBALS['SIMPLE_TITLE_MODULE'] = 1;    if ($LastNews == 1) {        if (!isset($_GET['cat']) || !is_numeric($_GET['cat']))            $pageNews = 0;        else            $pageNews = $_GET['cat'];        $limit = abs($NewsOnPasge * $pageNews);        $countNews = Simple_DbApi::CountTable($_GET['page'], "", "");        if ($countNews > $NewsOnPasge) {            $FullPage = intval(($countNews - 1) / $NewsOnPasge) + 1;            $MaxGoBack = $FullPage - $MaxListNumber;            if ($pageNews > ($FullPage - 1) || $pageNews < 0)                $pageNews = 0;            if (($pageNews + 1) <= $MaxListNumber) {                $start = 0;                if ($MaxListNumber > $FullPage)                    $end = $FullPage;                else                    $end = $MaxListNumber;            } else {                if ($pageNews == ($FullPage - 1) || $pageNews > $MaxGoBack) {                    $start = $FullPage - $MaxListNumber;                    $end = $FullPage;                } else {                    $start = $pageNews - (round($MaxListNumber / 2));                    $end = $MaxListNumber + $start;                }            }            for ($t = $start; $t < $end; $t++) {                if ($t != 0) {                    if ($pageNews == $t)                        $goPage .= CMS::section_list(5, "{n}", ($t + 1));                    else                        $goPage .= CMS::section_list(4, "{url},{n}", "" . $_GET['page'] . "/" . $t . "/<><>" . ($t + 1));                } else {                    if ($pageNews == $t)                        $goPage .= CMS::section_list(5, "{n}", ($t + 1));                    else                        $goPage .= CMS::section_list(4, "{url},{n}", "" . $_GET['page'] . "/<><>" . ($t + 1));                }            }            if ($pageNews != 0)                $back = CMS::section_list(14, '{url}', "" . $_GET['page'] . "/" . ($pageNews - 1) . "/");            else if ($pageNews == 1)                $back = CMS::section_list(14, '{url}', "" . $_GET['page'] . "/");            else                $back = '';            if (($FullPage - 1) != $pageNews)                $next = CMS::section_list(15, '{url}', "" . $_GET['page'] . "/" . ($pageNews + 1) . "/");            else                $next = '';            //$content .= CMS::section_list(13,'{list},{next},{back}',$goPage."<><>".$next."<><>".$back);        }        $SelectNews = Simple_DbApi::query_db("SELECT * FROM " . _PREFIXDB_ . $_GET['page'] . " LEFT OUTER JOIN " . $_GET['page'] . "_cat ON " . $_GET['page'] . ".id_cat = " . $_GET['page'] . "_cat.ids " . $SelectionOption1 . "ORDER BY `date` DESC, `time` DESC LIMIT $limit , $NewsOnPasge");        if (!empty($SelectNews)) {            foreach ($SelectNews as $i => $ns) {                list($year, $month, $day) = explode("-", $ns['date'], 3);                list($yearend, $monthend, $dayend) = explode("-", $ns['dateend'], 3);                $ns[$textindex] = str_replace("\\", "", $ns[$textindex]);                if ($PageBreak) $ns[$textindex] = str_replace("<!-- pagebreak -->", "", $ns[$textindex]);                if ($yearend == '0000') $DateFormat = $day . " " . $DateList[($month - 1)] . " " . $year;                else if ($day != $dayend && $month == $monthend && $year == $yearend) $DateFormat = $day . '-' . $dayend . " " . $DateList[($month - 1)] . " " . $year;                else if ($day != $dayend && $month != $monthend && $year == $yearend) $DateFormat = $day . ' ' . $DateList[($month - 1)] . '-' . $dayend . " " . $DateList[($monthend - 1)] . " " . $year;                else $DateFormat = $day . " " . $DateList[($month - 1)] . " " . $year . ' - ' . $dayend . " " . $DateList[($monthend - 1)] . " " . $yearend;                $DateFormat1 = $day . "/" . $month;                $DateFormat2 = $ns['time'];                if (!is_numeric($cat)) $url = URL_SITE . 'news/0/in/0/0/' . $ns['id'] . '/';                else $url = URL_SITE . 'news/0/in/' . $ns['id_cat'] . '/0/' . $ns['id'] . '/';                $image = '';                if ($ns['type'] != '') {                    $imgPath = 'images/news/small/' . $ns['id'] . '.' . $ns['type'];                    if (file_exists($imgPath)) $image = CMS::section_list(28, "{url},{image}", $url . "<><>" . '' . URL_SITE . $imgPath);                } else {                    $ns['full'] = CMS::ClearContent($ns['full']);                    preg_match("!src=\"(.*?)\"!si", $ns['full'], $match);                    if (!empty($match[1])) $image = CMS::section_list(30, '{url},{image}', $url . '<><>' . $match[1]);                }                if ($ns['comment'] == 1)                    $content .= CMS::section_list(1, "{name},{text},{image},{date},{date1},{date2},{cat},{url},{countcomment}", $ns['name'] . "<><>" . $ns[$textindex] . "<><>" . $image . "<><>" . $DateFormat . "<><>" . $DateFormat . "<><>" . $DateFormat2 . "<><>" . $ns['names'] . "<><>" . "" . $_GET['page'] . "/" . $pageNews . "/in/" . $ns['id_cat'] . "/0/" . $ns['id'] . "/<><>" . $ns['countcomments']);                else                    $content .= CMS::section_list('1-1', "{name},{text},{image},{date},{date1},{date2},{cat},{url},{countcomment},{idnew}", $ns['name'] . "<><>" . $ns['full'] . "<><>" . $image . "<><>" . $DateFormat . "<><>" . $DateFormat . "<><>" . $DateFormat2 . "<><>" . $ns['names'] . "<><>" . "" . $_GET['page'] . "/" . $pageNews . "/in/" . $ns['id_cat'] . "/0/" . $ns['id'] . "/<><>" . $ns['countcomments'] . "<><>" . $ns['id']);            }        }        if ($countNews > $NewsOnPasge)            $content .= CMS::section_list(13, '{list},{next},{back}', $goPage . "<><>" . $next . "<><>" . $back);    } else {        $SelectCategory = Simple_DbApi::select_db($_GET['page'] . "_cat", "*", "", "", "names", 1, "", "");        if (!empty($SelectCategory)) {            foreach ($SelectCategory as $i => $nc) {                $list .= CMS::section_list(3, "{url},{name}", "" . $_GET['page'] . "/0/in/" . $nc['ids'] . "/<><>" . $nc['names']);            }        }        $content .= CMS::section_list(2, "{url},{list}", "<><>" . $list);    }} else {    $SelectCategory = Simple_DbApi::select_db($_GET['page'] . "_cat", "*", "ids", $_GET['in'], "", "", "", "");    if (!empty($SelectCategory) || $_GET['in'] == 0) {        if (!isset($_GET['ppp']) || !is_numeric($_GET['ppp'])) {            if ($TitleNewsCat != 1)                $GLOBALS['SIMPLE_TITLE_MODULE'] = 1;            $nt = current($SelectCategory);            $title_go = $nt['names'];            if (!isset($_GET['pages_all']) || !is_numeric($_GET['pages_all']))                $pageNews = 0;            else                $pageNews = $_GET['pages_all'];            $limit = abs($NewsOnPasge * $pageNews);            $SelectNews = Simple_DbApi::query_db("SELECT * FROM " . _PREFIXDB_ . $_GET['page'] . " LEFT OUTER JOIN " . $_GET['page'] . "_cat ON " . $_GET['page'] . ".id_cat = " . $_GET['page'] . "_cat.ids WHERE  `id_cat` =  '" . $_GET['in'] . "' " . $SelectionOption2 . "ORDER BY  `date` DESC ,  `time` DESC LIMIT $limit , $NewsOnPasge");            if (!empty($SelectNews)) {                foreach ($SelectNews as $i => $ns) {                    list($year, $month, $day) = explode("-", $ns['date'], 3);                    list($yearend, $monthend, $dayend) = explode("-", $ns['dateend'], 3);                    $ns[$textindex] = str_replace("\\", "", $ns[$textindex]);                    if ($PageBreak) $ns[$textindex] = str_replace("<!-- pagebreak -->", "", $ns[$textindex]);                    if ($yearend == '0000') $DateFormat = $day . " " . $DateList[($month - 1)] . " " . $year;                    else if ($day != $dayend && $month == $monthend && $year == $yearend) $DateFormat = $day . '-' . $dayend . " " . $DateList[($month - 1)] . " " . $year;                    else if ($day != $dayend && $month != $monthend && $year == $yearend) $DateFormat = $day . ' ' . $DateList[($month - 1)] . '-' . $dayend . " " . $DateList[($monthend - 1)] . " " . $year;                    else $DateFormat = $day . " " . $DateList[($month - 1)] . " " . $year . ' - ' . $dayend . " " . $DateList[($monthend - 1)] . " " . $yearend;                    $DateFormat1 = $day . "." . $month . "." . $year;                    $DateFormat2 = $ns['time'];                    if (!is_numeric($cat)) $url = URL_SITE . 'news/0/in/0/0/' . $ns['id'] . '/';                    else $url = URL_SITE . 'news/0/in/' . $ns['id_cat'] . '/0/' . $ns['id'] . '/';                    $image = '';                    if ($ns['type'] != '') {                        $imgPath = 'images/news/small/' . $ns['id'] . '.' . $ns['type'];                        if (file_exists($imgPath)) {                            $image = CMS::section_list(28, "{url},{image}", $url . "<><>" . '' . URL_SITE . $imgPath);                        }                    } else {                        $ns['full'] = CMS::ClearContent($ns['full']);                        preg_match("!src=\"(.*?)\"!si", $ns['full'], $match);                        if (!empty($match[1])) $image = CMS::section_list(30, '{url},{image}', $url . '<><>' . $match[1]);                    }                    if ($ns['comment'] == 1)                        $content .= CMS::section_list(1, "{name},{text},{image},{date},{date1},{date2},{cat},{url},{countcomment}", $ns['name'] . "<><>" . $ns[$textindex] . "<><>" . $image . "<><>" . $DateFormat . "<><>" . $DateFormat . "<><>" . $DateFormat2 . "<><>" . $ns['names'] . "<><>" . "" . $_GET['page'] . "/" . $pageNews . "/in/" . $ns['id_cat'] . "/0/" . $ns['id'] . "/<><>" . $ns['countcomments']);                    else                        $content .= CMS::section_list('1-1', "{name},{text},{image},{date},{date1},{date2},{cat},{url},{countcomment}", $ns['name'] . "<><>" . $ns[$textindex] . "<><>" . $image . "<><>" . $DateFormat . "<><>" . $DateFormat . "<><>" . $DateFormat2 . "<><>" . $ns['names'] . "<><>" . "" . $_GET['page'] . "/" . $pageNews . "/in/" . $ns['id_cat'] . "/0/" . $ns['id'] . "/<><>" . $ns['countcomments']);                }            }            $res = CMS::$db->query("SELECT COUNT(*) FROM `" . _PREFIXDB_ . $_GET['page'] . "`" . $SelectionOption1 . " AND `id_cat`='" . $_GET['in'] . "'");            $countNews = $res[0]['COUNT(*)'];            if ($countNews > $NewsOnPasge) {                $FullPage = intval(($countNews - 1) / $NewsOnPasge) + 1;                $MaxGoBack = $FullPage - $MaxListNumber;                if ($pageNews > ($FullPage - 1) || $pageNews < 0)                    $pageNews = 0;                if (($pageNews + 1) <= $MaxListNumber) {                    $start = 0;                    if ($MaxListNumber > $FullPage)                        $end = $FullPage;                    else                        $end = $MaxListNumber;                } else {                    if ($pageNews == ($FullPage - 1) || $pageNews > $MaxGoBack) {                        $start = $FullPage - $MaxListNumber;                        $end = $FullPage;                    } else {                        $start = $pageNews - (round($MaxListNumber / 2));                        $end = $MaxListNumber + $start;                    }                }                for ($t = $start; $t < $end; $t++) {                    if ($pageNews == $t)                        $goPage .= CMS::section_list(5, "{n}", ($t + 1));                    else                        $goPage .= CMS::section_list(4, "{url},{n}", "/" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . $t . "/<><>" . ($t + 1));                }                if ($pageNews != 0)                    $back = CMS::section_list(14, '{url}', "/" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . ($pageNews - 1) . "/");                else if ($pageNews == 1)                    $back = CMS::section_list(14, '{url}', "/" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/");                else                    $back = '';                if (($FullPage - 1) != $pageNews)                    $next = CMS::section_list(15, '{url}', "/" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . ($pageNews + 1) . "/");                else                    $next = '';                $content .= CMS::section_list(13, '{list},{next},{back}', $goPage . "<><>" . $next . "<><>" . $back);            }        } else {            if (isset($_POST['go']) && is_numeric($_GET['in'])) {                $NameUser = strip_tags($_POST['UserName']);                $TextUser = strip_tags($_POST['UserText'], "<br />");                $TextUser = addslashes($TextUser);                if (strlen($NameUser) > 0) {                    if (strlen($TextUser) > 0) {                        Simple_DbApi::insert_db($_GET['page'] . "_comment", "id,id_cat,IdNews,name,text,date,dateh,ip", "<><>" . $_GET['in'] . "<><>" . $_GET['ppp'] . "<><>" . $NameUser . "<><>" . $TextUser . "<><>" . date("Y-m-d") . "<><>" . date("H:i:s") . "<><>" . $_SERVER['REMOTE_ADDR']);                        Simple_DbApi::update_db($_GET['page'], 'countcomments', Simple_DbApi::CountTable($_GET['page'] . "_comment", "IdNews", $_GET['ppp']), 'id', $_GET['ppp']);                    }                }            }            $SelectN = Simple_DbApi::select_db($_GET['page'], "*", "id", $_GET['ppp'], "", "", "", "");            $nn = current($SelectN);            $title_go = $nn['name'];            list($year, $month, $day) = explode("-", $nn['date'], 3);            list($yearend, $monthend, $dayend) = explode("-", $nn['dateend'], 3);            if ($yearend == '0000') $DateFormat = $day . " " . $DateList[($month - 1)] . " " . $year;            else if ($day != $dayend && $month == $monthend && $year == $yearend) $DateFormat = $day . '-' . $dayend . " " . $DateList[($month - 1)] . " " . $year;            else if ($day != $dayend && $month != $monthend && $year == $yearend) $DateFormat = $day . ' ' . $DateList[($month - 1)] . '-' . $dayend . " " . $DateList[($monthend - 1)] . " " . $year;            else $DateFormat = $day . " " . $DateList[($month - 1)] . " " . $year . ' - ' . $dayend . " " . $DateList[($monthend - 1)] . " " . $yearend;            $DateFormat1 = $day . "/" . $month;            $DateFormat2 = $ns['time'];            $nn['full'] = str_replace("\\", "", $nn['full']);            $content .= CMS::section_list(7, "{name},{text},{date},{date1},{date2},{url},{idnew}", $nn['name'] . "<><>" . $nn['full'] . "<><>" . $DateFormat . "<><>" . $DateFormat . "<><>" . $DateFormat2 . "<><>" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . $_GET['pages_all'] . "/" . "<><>" . $nn['id']);            if ($nn['comment'] == 1 && $comment == 1) {                if (!isset($_GET['st']) || !is_numeric($_GET['st']))                    $PageCom = 0;                else                    $PageCom = $_GET['st'];                $limit = abs($PageCom * $CommOnPasge);                $SelectComments = Simple_DbApi::select_db($_GET['page'] . "_comment", "*", "IdNews", $nn['id'], "id", 2, $limit, $CommOnPasge);                $style = 0;                if (!empty($SelectComments)) {                    foreach ($SelectComments as $j => $nj) {                        $textComment = str_replace("\\", "", $nj['text']);                        list($Y, $M, $D) = explode('-', $nj['date'], 3);                        $time = $nj['dateh'];                        $date1 = $D . '/' . $M;                        $date2 = $D . ' ' . $DateList[($M - 1)] . ' ' . $Y;                        if ($style != 1) {                            $styleD = CMS::section_list(18, '', '');                            $style = 1;                        } else {                            $styleD = CMS::section_list(19, '', '');                            $style = 0;                        }                        $ListCom .= CMS::section_list(9, "{name},{text},{date},{date1},{time},{style}", $nj['name'] . "<><>" . $textComment . "<><>" . $date1 . "<><>" . $date2 . "<><>" . $time . "<><>" . $styleD);                    }                }                $countComm = Simple_DbApi::CountTable($_GET['page'] . "_comment", "IdNews", $nn['id']);                if ($countComm > $CommOnPasge) {                    $FullCommPage = intval(($countComm - 1) / $CommOnPasge) + 1;                    $MaxGoBack = $FullCommPage - $MaxListComment;                    if ($PageCom > ($FullCommPage - 1) || $PageCom < 0)                        $PageCom = 0;                    if (($PageCom + 1) <= $MaxListComment) {                        $start = 0;                        if ($MaxListComment > $FullCommPage)                            $end = $FullCommPage;                        else                            $end = $MaxListComment;                    } else {                        if ($PageCom == ($FullCommPage - 1) || $PageCom > $MaxGoBack) {                            $start = $FullCommPage - $MaxListComment;                            $end = $FullCommPage;                        } else {                            $start = $PageCom - (round($MaxListComment / 2));                            $end = $MaxListComment + $start;                        }                    }                    if ($PageCom != 0)                        $ListPC .= CMS::section_list(16, "{url}", "" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . $_GET['pages_all'] . "/" . $nn['id'] . "/" . ($PageCom - 1) . "/");                    for ($s = $start; $s < $end; $s++) {                        if ($PageCom == $s)                            $ListPC .= CMS::section_list(12, "{n}", ($s + 1));                        else                            $ListPC .= CMS::section_list(11, "{n},{url}", ($s + 1) . "<><>" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . $_GET['pages_all'] . "/" . $nn['id'] . "/" . $s . "/");                    }                    if (($FullCommPage - 1) != $PageCom)                        $ListPC .= CMS::section_list(17, "{url}", "" . $_GET['page'] . "/0/in/" . $_GET['in'] . "/" . $_GET['pages_all'] . "/" . $nn['id'] . "/" . ($PageCom + 1) . "/");                    $numberP = CMS::section_list(10, "{number}", $ListPC);                } else                    $numberP = "";                $content .= CMS::section_list(8, "{listcom},{page},{countcomment}", $ListCom . "<><>" . $numberP . "<><>" . $nn['countcomments']);            }        }    } else $content .= CMS::section_list(6, "", "");}?>